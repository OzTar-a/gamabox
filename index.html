<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸåˆä¹‹æ˜Ÿ & ç¶“é©—è¨ˆç®—</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            line-height: 1.6;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container { width: 90%; max-width: 1000px; margin: 0 auto; }

        header {
            background-color: #2c3e50;
            color: #fff;
            padding: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo-area {
            padding: 1rem 0;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-tabs {
            display: flex;
            width: 100%;
            max-width: 600px;
            list-style: none;
            margin-bottom: -2px;
        }

        .nav-tabs li { flex: 1; text-align: center; }

        .nav-tabs a {
            display: block;
            padding: 15px 0;
            color: #bdc3c7;
            text-decoration: none;
            font-weight: 600;
            border-bottom: 4px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-tabs a:hover {
            color: #ecf0f1;
            background-color: rgba(255,255,255,0.05);
        }

        .nav-tabs a.active {
            color: #fff;
            border-bottom: 4px solid #e74c3c;
        }

        main { flex: 1; padding: 40px 0; }

        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .tool-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            overflow: hidden;
            max-width: 800px;
            margin: 0 auto;
        }

        .card-header {
            background: #34495e;
            color: #fff;
            padding: 20px;
            text-align: center;
        }
        .card-header h2 { margin: 0; font-size: 1.5rem; }
        .card-header p { opacity: 0.8; font-size: 0.9rem; margin-top: 5px; }

        .card-body { padding: 30px; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; font-size: 0.95rem; }
        
        .form-group input,
        .simple-view input {
            width: 100%; 
            padding: 12px 15px; 
            border: 2px solid #e0e0e0;
            border-radius: 8px; 
            font-size: 1rem; 
            outline: none; 
            transition: border-color 0.3s;
            background: #fff;
        }
        
        .form-group input:focus,
        .simple-view input:focus { 
            border-color: #3498db; 
        }

        .row-group { display: flex; gap: 15px; }
        .row-group .form-group { flex: 1; margin-bottom: 0; }

        .category-section {
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .category-title::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 18px;
            background: #3498db;
            margin-right: 10px;
            border-radius: 2px;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
        }
        
        .toggle-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.85rem;
            color: #7f8c8d;
            font-weight: 600;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
            margin-left: 8px;
        }

        .switch input { opacity: 0; width: 0; height: 0; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 14px; width: 14px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider { background-color: #e74c3c; }
        input:checked + .slider:before { transform: translateX(20px); }

        .hidden { display: none !important; }
        
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .grid-5 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        
        .detail-item {
            min-width: 0; 
        }

        .detail-item label {
            font-size: 0.75rem;
            color: #7f8c8d;
            margin-bottom: 2px;
            display: block;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .detail-item input {
            width: 100%; 
            padding: 8px;
            font-size: 0.9rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            outline: none;
            background: #fff;
            transition: border-color 0.3s;
        }
        
        .detail-item input:focus {
            border-color: #3498db;
        }

        .relic-group {
            margin-bottom: 15px;
        }
        .relic-group-title {
            font-size: 0.85rem;
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
            padding-left: 5px;
            border-left: 3px solid #bdc3c7;
        }

        .result-box {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: #fff;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: center;
        }
        .result-item {
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }
        .result-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        
        .result-label { font-size: 1.1rem; opacity: 0.9; }
        .result-value { font-size: 1.5rem; font-weight: bold; color: #f1c40f; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        
        .time-result { font-size: 1.8rem; color: #f1c40f; font-weight: bold; display: block; margin-top: 10px; }
        .sub-result-label { font-size: 0.95rem; opacity: 0.8; display: block; margin-bottom: 5px;}
        .sub-result-value { font-size: 1.2rem; color: #ecf0f1; font-weight: 600; }
        .note { font-size: 0.85rem; color: #7f8c8d; text-align: center; margin-top: 15px; }

        footer { background: #2c3e50; color: #bdc3c7; text-align: center; padding: 20px 0; font-size: 0.9rem; margin-top: auto; }

        @media (max-width: 600px) {
            .row-group { flex-direction: column; gap: 20px; }
            .grid-4, .grid-5 { grid-template-columns: repeat(2, 1fr); }
            .category-title { font-size: 1rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container">
            <div class="logo-area"></div>
            <ul class="nav-tabs">
                <li><a class="active" onclick="switchTab('tab-star')">åŸåˆä¹‹æ˜Ÿ</a></li>
                <li><a onclick="switchTab('tab-exp')">ç¶“é©—è¨ˆç®—</a></li>
            </ul>
        </div>
    </header>

    <main>
        <div class="container">
            
            <div id="tab-star" class="tab-content active">
                <div class="tool-card">
                    <div class="card-header">
                        <h2>ğŸ† è³½å­£ç­‰ç´šè¨ˆç®—æ©Ÿ</h2>
                        <p>è¼¸å…¥è§’è‰²æ•¸æ“šï¼Œé æ¸¬åŸåˆä¹‹æ˜Ÿè©•åˆ†</p>
                    </div>
                    <div class="card-body">
                        
                        <div class="form-group">
                            <label for="charLevel">è§’è‰²ç­‰ç´š (Lv)</label>
                            <input type="number" id="charLevel" placeholder="100-120">
                        </div>

                        <div class="form-group">
                            <label>ç•¶å‰ç¶“é©—</label>
                            <input type="number" id="currentExp" placeholder="0">
                            <p class="note" style="text-align: left; margin-top: 5px; font-size: 0.8rem;">
                                * ç¶“é©—ä¸Šé™å°‡è‡ªå‹•å¸¶å…¥ï¼›æ”¯æ´æ™ºæ…§è¼¸å…¥ (å¦‚ 12.6 = 126,000)
                            </p>
                        </div>

                        <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">

                        <div class="category-section" id="section-skill">
                            <div class="category-header">
                                <div class="category-title">æŠ€èƒ½ç­‰ç´š</div>
                                <div class="toggle-wrapper">
                                    <label class="toggle-label">
                                        è©³ç´°è¼¸å…¥
                                        <label class="switch">
                                            <input type="checkbox" id="toggle-skill" onchange="toggleSection('skill')">
                                            <span class="slider"></span>
                                        </label>
                                    </label>
                                </div>
                            </div>
                            <div class="simple-view">
                                <input type="number" id="avgSkill" class="calc-input" placeholder="è¼¸å…¥å¹³å‡ç­‰ç´š">
                            </div>
                            <div class="detail-view hidden">
                                <div class="relic-group-title">ä¸»å‹•æŠ€èƒ½</div>
                                <div class="grid-4" style="margin-bottom: 10px;">
                                    <div class="detail-item"><input type="number" class="detail-input skill-detail" placeholder="ä¸»å‹•1"></div>
                                    <div class="detail-item"><input type="number" class="detail-input skill-detail" placeholder="ä¸»å‹•2"></div>
                                    <div class="detail-item"><input type="number" class="detail-input skill-detail" placeholder="ä¸»å‹•3"></div>
                                    <div class="detail-item"><input type="number" class="detail-input skill-detail" placeholder="ä¸»å‹•4"></div>
                                </div>
                                <div class="relic-group-title">è¢«å‹•æŠ€èƒ½</div>
                                <div class="grid-4">
                                    <div class="detail-item"><input type="number" class="detail-input skill-detail" placeholder="è¢«å‹•1"></div>
                                    <div class="detail-item"><input type="number" class="detail-input skill-detail" placeholder="è¢«å‹•2"></div>
                                    <div class="detail-item"><input type="number" class="detail-input skill-detail" placeholder="è¢«å‹•3"></div>
                                    <div class="detail-item"><input type="number" class="detail-input skill-detail" placeholder="è¢«å‹•4"></div>
                                </div>
                            </div>
                        </div>

                        <div class="category-section" id="section-equip">
                            <div class="category-header">
                                <div class="category-title">è£å‚™ç­‰ç´š</div>
                                <div class="toggle-wrapper">
                                    <label class="toggle-label">
                                        è©³ç´°è¼¸å…¥
                                        <label class="switch">
                                            <input type="checkbox" id="toggle-equip" onchange="toggleSection('equip')">
                                            <span class="slider"></span>
                                        </label>
                                    </label>
                                </div>
                            </div>
                            <div class="simple-view">
                                <input type="number" id="avgEquip" class="calc-input" placeholder="è¼¸å…¥å¹³å‡ç­‰ç´š">
                            </div>
                            <div class="detail-view hidden">
                                <div class="grid-5">
                                    <div class="detail-item"><label>æ­¦å™¨</label><input type="number" class="detail-input equip-detail"></div>
                                    <div class="detail-item"><label>å‰¯æ­¦</label><input type="number" class="detail-input equip-detail"></div>
                                    <div class="detail-item"><label>å¸½å­</label><input type="number" class="detail-input equip-detail"></div>
                                    <div class="detail-item"><label>è¡£æœ</label><input type="number" class="detail-input equip-detail"></div>
                                    <div class="detail-item"><label>é‹å­</label><input type="number" class="detail-input equip-detail"></div>
                                </div>
                            </div>
                        </div>

                        <div class="category-section" id="section-pal">
                            <div class="category-header">
                                <div class="category-title">å¹»ç¸ç­‰ç´š</div>
                                <div class="toggle-wrapper">
                                    <label class="toggle-label">
                                        è©³ç´°è¼¸å…¥
                                        <label class="switch">
                                            <input type="checkbox" id="toggle-pal" onchange="toggleSection('pal')">
                                            <span class="slider"></span>
                                        </label>
                                    </label>
                                </div>
                            </div>
                            <div class="simple-view">
                                <input type="number" id="avgPal" class="calc-input" placeholder="è¼¸å…¥å¹³å‡ç­‰ç´š">
                            </div>
                            <div class="detail-view hidden">
                                <div class="grid-4">
                                    <div class="detail-item"><label>å‡ºæˆ°</label><input type="number" class="detail-input pal-detail"></div>
                                    <div class="detail-item"><label>è¼”åŠ©1</label><input type="number" class="detail-input pal-detail"></div>
                                    <div class="detail-item"><label>è¼”åŠ©2</label><input type="number" class="detail-input pal-detail"></div>
                                    <div class="detail-item"><label>è¼”åŠ©3</label><input type="number" class="detail-input pal-detail"></div>
                                </div>
                            </div>
                        </div>

                        <div class="category-section" id="section-relic">
                            <div class="category-header">
                                <div class="category-title">éºç‰©ç­‰ç´š</div>
                                <div class="toggle-wrapper">
                                    <label class="toggle-label">
                                        è©³ç´°è¼¸å…¥
                                        <label class="switch">
                                            <input type="checkbox" id="toggle-relic" onchange="toggleSection('relic')">
                                            <span class="slider"></span>
                                        </label>
                                    </label>
                                </div>
                            </div>
                            <div class="simple-view">
                                <input type="number" id="avgRelic" class="calc-input" placeholder="è¼¸å…¥å¹³å‡ç­‰ç´š">
                            </div>
                            <div class="detail-view hidden">
                                <div class="relic-group">
                                    <div class="relic-group-title">å…‰éºç‰©</div>
                                    <div class="grid-4">
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="1"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="2"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="3"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="4"></div>
                                    </div>
                                </div>
                                <div class="relic-group">
                                    <div class="relic-group-title">æš—éºç‰©</div>
                                    <div class="grid-4">
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="1"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="2"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="3"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="4"></div>
                                    </div>
                                </div>
                                <div class="relic-group">
                                    <div class="relic-group-title">é¢¨éºç‰©</div>
                                    <div class="grid-4">
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="1"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="2"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="3"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="4"></div>
                                    </div>
                                </div>
                                <div class="relic-group">
                                    <div class="relic-group-title">æ°´éºç‰©</div>
                                    <div class="grid-4">
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="1"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="2"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="3"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="4"></div>
                                    </div>
                                </div>
                                <div class="relic-group">
                                    <div class="relic-group-title">ç«éºç‰©</div>
                                    <div class="grid-4">
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="1"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="2"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="3"></div>
                                        <div class="detail-item"><input type="number" class="detail-input relic-detail" placeholder="4"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="result-box">
                            <div class="result-item">
                                <span class="result-label">ç¸½åˆ†</span>
                                <span id="star-totalScore" class="result-value">0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">åŸåˆä¹‹æ˜Ÿ</span>
                                <span id="star-final" class="result-value">10.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-exp" class="tab-content">
                <div class="tool-card">
                    <div class="card-header">
                        <h2>â³ å‡ç´šæ™‚é–“è¨ˆç®—</h2>
                        <p>è¨ˆç®—æ›æ©Ÿæ‰€éœ€æ™‚é–“ï¼ŒåŒ…å«åŠ é€Ÿé“å…·æŠ˜æŠµ</p>
                    </div>
                    <div class="card-body">
                        <div class="form-group row-group">
                            <div class="form-group">
                                <label>ç¾åœ¨ç­‰ç´š</label>
                                <input type="number" id="exp-currentLv" placeholder="ä¾‹å¦‚ 100">
                            </div>
                            <div class="form-group">
                                <label>ç›®æ¨™ç­‰ç´š</label>
                                <input type="number" id="exp-targetLv" placeholder="ä¾‹å¦‚ 120">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>ç¾åœ¨å·²ç´¯ç©ç¶“é©—</label>
                            <input type="number" id="exp-currentExp" placeholder="0">
                            <p class="note" style="text-align: left; margin-top: 5px; font-size: 0.8rem;">
                                * æ”¯æ´æ™ºæ…§è¼¸å…¥ (å¦‚ 12.6 = 126,000)
                            </p>
                        </div>

                        <div class="form-group">
                            <label>æ¯å°æ™‚ç¶“é©— (Exp/Hr)</label>
                            <input type="number" id="exp-perHour" placeholder="ä¾‹å¦‚ 350000">
                        </div>

                        <div class="form-group row-group">
                            <div class="form-group">
                                <label>å…è²»åŠ é€Ÿ (æ¬¡)</label>
                                <input type="number" id="exp-freeSpeedup" placeholder="æ¬¡æ•¸">
                            </div>
                            <div class="form-group">
                                <label>åŠ é€ŸçŸ³é ­ (é¡†)</label>
                                <input type="number" id="exp-stoneSpeedup" placeholder="æ¬¡æ•¸">
                            </div>
                        </div>
                        <p class="note" style="margin-bottom: 20px; text-align: left;">* è¨»ï¼šæ¯æ¬¡åŠ é€Ÿå‡ä»¥ 2 å°æ™‚ç¶“é©—è¨ˆç®—</p>

                        <div class="result-box">
                            <div style="margin-bottom: 20px;">
                                <span class="result-label">é è¨ˆæ‰€éœ€æ™‚é–“ (å«åŠ é€Ÿ)</span>
                                <span id="exp-timeResult" class="time-result">0å¤© 0å°æ™‚ 0åˆ†</span>
                            </div>
                            <div style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 15px;">
                                <span class="sub-result-label">è‹¥å®Œå…¨ä¸ä½¿ç”¨åŠ é€Ÿé“å…·</span>
                                <span id="exp-timeResult-original" class="sub-result-value">0å¤© 0å°æ™‚ 0åˆ†</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer>
        <p>&copy; 2024 GameGuide. æ•¸æ“šèˆ‡åœ–ç‰‡åƒ…ä¾›åƒè€ƒ.</p>
    </footer>

    <script>
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-tabs a').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleSection(sectionName) {
            const toggle = document.getElementById(`toggle-${sectionName}`);
            const section = document.getElementById(`section-${sectionName}`);
            const simpleView = section.querySelector('.simple-view');
            const detailView = section.querySelector('.detail-view');

            if (toggle.checked) {
                simpleView.classList.add('hidden');
                detailView.classList.remove('hidden');
            } else {
                simpleView.classList.remove('hidden');
                detailView.classList.add('hidden');
            }
            calculateStar();
        }

        const expTable = {
            100: 886086, 101: 888547, 102: 926501, 103: 964086, 104: 1012164,
            105: 1054111, 106: 1096529, 107: 1135645, 108: 1174997, 109: 1214584,
            110: 1258533, 111: 1303677, 112: 1348574, 113: 1393941, 114: 1439780,
            115: 1486091, 116: 1532872, 117: 1580125, 118: 1627849, 119: 1676044,
            120: 1730017, 121: 1783360, MAX_VAL: 1833196 
        };

        function getExpForLevel(lvl) {
            if (lvl < 100) return 0;
            if (lvl >= 122) return expTable.MAX_VAL;
            return expTable[lvl] || expTable.MAX_VAL;
        }

        function getSmartExpValue(id) {
            const el = document.getElementById(id);
            if (!el || el.value === "") return 0;
            let val = Number(el.value);
            
            if (val > 0 && val < 300) { 
                return Math.round(val * 10000); 
            }
            return val;
        }

        const allStarInputs = document.querySelectorAll('#tab-star input');
        allStarInputs.forEach(input => {
            input.addEventListener('input', calculateStar);
        });

        function calculateStar() {
            const getVal = (id) => {
                const el = document.getElementById(id);
                return el.value === "" ? null : Number(el.value);
            };

            const charLevel = getVal('charLevel');
            let scoreLevel = (charLevel === null) ? 0 : Math.max(0, (charLevel - 100)) * 100;
            
            const currentExp = getSmartExpValue('currentExp'); 
            
            let autoMaxExp = 0;
            if (charLevel !== null) {
                autoMaxExp = getExpForLevel(charLevel);
            }
            let scoreExp = (autoMaxExp > 0) ? Math.round((currentExp / autoMaxExp) * 100) : 0;
            
            const calcDetailedSum = (selector, base, weight) => {
                let sum = 0;
                document.querySelectorAll(selector).forEach(el => {
                    let val = el.value === "" ? 0 : Number(el.value);
                    sum += Math.max(0, (val - base)) * weight;
                });
                return sum;
            };

            const calcSimpleScore = (id, base, weightPerSlot, slotCount) => {
                const val = getVal(id);
                return (val === null) ? 0 : Math.max(0, (val - base)) * weightPerSlot * slotCount;
            };

            let scoreSkill = 0;
            if (document.getElementById('toggle-skill').checked) {
                scoreSkill = calcDetailedSum('.skill-detail', 100, 13);
            } else {
                scoreSkill = calcSimpleScore('avgSkill', 100, 13, 8);
            }

            let scoreEquip = 0;
            if (document.getElementById('toggle-equip').checked) {
                scoreEquip = calcDetailedSum('.equip-detail', 100, 38);
            } else {
                scoreEquip = calcSimpleScore('avgEquip', 100, 38, 5);
            }

            let scorePal = 0;
            if (document.getElementById('toggle-pal').checked) {
                scorePal = calcDetailedSum('.pal-detail', 100, 14);
            } else {
                scorePal = calcSimpleScore('avgPal', 100, 14, 4);
            }

            let scoreRelic = 0;
            if (document.getElementById('toggle-relic').checked) {
                scoreRelic = calcDetailedSum('.relic-detail', 10, 57);
            } else {
                scoreRelic = calcSimpleScore('avgRelic', 10, 57, 20);
            }

            const total = scoreLevel + scoreExp + scoreSkill + scoreEquip + scorePal + scoreRelic;
            const stars = 10 + (total / 100);

            document.getElementById('star-totalScore').textContent = new Intl.NumberFormat().format(total);
            document.getElementById('star-final').textContent = stars.toFixed(2);
        }

        const expInputs = ['exp-currentLv', 'exp-targetLv', 'exp-currentExp', 'exp-perHour', 'exp-freeSpeedup', 'exp-stoneSpeedup'];
        expInputs.forEach(id => {
            const el = document.getElementById(id);
            if(el) el.addEventListener('input', calculateTime);
        });
        
        function formatTime(totalHours) {
            if (totalHours <= 0) return "0åˆ†";
            const days = Math.floor(totalHours / 24);
            const remainingHours = Math.floor(totalHours % 24);
            const minutes = Math.round((totalHours * 60) % 60);
            let timeString = "";
            if (days > 0) timeString += `${days}å¤© `;
            if (remainingHours > 0 || days > 0) timeString += `${remainingHours}å°æ™‚ `;
            timeString += `${minutes}åˆ†`;
            return timeString;
        }

        function calculateTime() {
            const currentLv = Number(document.getElementById('exp-currentLv').value);
            const targetLv = Number(document.getElementById('exp-targetLv').value);
            
            const currentExp = getSmartExpValue('exp-currentExp');
            
            const expPerHour = Number(document.getElementById('exp-perHour').value) || 0;
            const freeSpeedup = Number(document.getElementById('exp-freeSpeedup').value) || 0;
            const stoneSpeedup = Number(document.getElementById('exp-stoneSpeedup').value) || 0;

            if (!currentLv || !targetLv || currentLv >= targetLv) {
                document.getElementById('exp-timeResult').textContent = "è«‹è¼¸å…¥æ­£ç¢ºç­‰ç´šç¯„åœ";
                document.getElementById('exp-timeResult-original').textContent = "--";
                return;
            }

            let totalNeeded = 0;
            for (let lv = currentLv; lv < targetLv; lv++) {
                totalNeeded += getExpForLevel(lv);
            }
            let baseRemainingNeeded = totalNeeded - currentExp;

            if (baseRemainingNeeded <= 0) {
                document.getElementById('exp-timeResult').textContent = "å·²é”æˆç›®æ¨™ï¼";
                document.getElementById('exp-timeResult-original').textContent = "å·²é”æˆç›®æ¨™ï¼";
                return;
            }

            if (expPerHour <= 0) {
                document.getElementById('exp-timeResult').textContent = "è«‹è¼¸å…¥æ¯å°æ™‚ç¶“é©—";
                document.getElementById('exp-timeResult-original').textContent = "è«‹è¼¸å…¥æ¯å°æ™‚ç¶“é©—";
                return;
            }

            const baseHoursNeeded = baseRemainingNeeded / expPerHour;
            document.getElementById('exp-timeResult-original').textContent = formatTime(baseHoursNeeded);

            const speedupHours = (freeSpeedup + stoneSpeedup) * 2;
            const speedupExp = speedupHours * expPerHour;
            let actualRemainingNeeded = baseRemainingNeeded - speedupExp;

            if (actualRemainingNeeded <= 0) {
                document.getElementById('exp-timeResult').textContent = "åŠ é€Ÿå¾Œå¯ç«‹å³é”æˆï¼";
                return;
            }

            const actualHoursNeeded = actualRemainingNeeded / expPerHour;
            document.getElementById('exp-timeResult').textContent = formatTime(actualHoursNeeded);
        }
    </script>
</body>
</html>